<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Claude Conductor</title>
    <link rel="stylesheet" href="/static/css/conductor.css">
    <!-- Alpine.js from CDN - no build step needed -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body>
    <!-- Main app container with Alpine.js -->
    <div x-data="conductorApp()" x-init="init()" x-cloak class="container">

        <!-- Header -->
        <header>
            <h1>Simple Claude Conductor</h1>
            <p>Build software projects with AI assistance</p>
        </header>

        <!-- Connection status banner -->
        <div x-show="!connected" class="banner banner--warning">
            <span>Reconnecting to server...</span>
        </div>

        <!-- Error banner -->
        <div x-show="state.state === 'error'" class="banner banner--error">
            <strong>Error:</strong> <span x-text="state.error"></span>
            <div class="actions">
                <button @click="retry()" class="btn btn--small">Retry</button>
                <button @click="resetProject()" class="btn btn--small btn--secondary">Reset</button>
            </div>
        </div>

        <!-- Stage progress indicator -->
        <nav class="stages" aria-label="Progress">
            <template x-for="(stage, index) in stages" :key="stage.id">
                <div class="stage"
                     :class="{
                         'stage--complete': isStageComplete(stage.id),
                         'stage--active': isStageActive(stage.id)
                     }">
                    <div class="stage__dot" x-text="index + 1"></div>
                    <div class="stage__label" x-text="stage.label"></div>
                </div>
            </template>
        </nav>

        <!-- Main status card -->
        <section class="card">
            <header class="card__header">
                <span class="status-dot" :class="statusDotClass"></span>
                <h2 x-text="statusTitle"></h2>
            </header>

            <!-- Activity message -->
            <div class="activity-box" :class="{ 'activity-box--waiting': state.state === 'questions' }">
                <p x-text="state.activity || 'Ready to start'"></p>
                <!-- Heartbeat indicator during active states -->
                <small x-show="showHeartbeat" class="heartbeat" x-text="heartbeatText"></small>
            </div>

            <!-- Progress bar (when executing) -->
            <div x-show="state.total_phases > 0" class="progress">
                <div class="progress__bar">
                    <div class="progress__fill" :style="{ width: progressPercent + '%' }"></div>
                </div>
                <div class="progress__info">
                    <span x-text="phaseLabel"></span>
                    <span x-text="progressPercent + '%'"></span>
                </div>
            </div>

            <!-- Action buttons -->
            <div class="actions">
                <button @click="performAction()"
                        :disabled="!canPerformAction"
                        class="btn btn--primary">
                    <span x-show="loading" class="spinner"></span>
                    <span x-text="actionButtonText"></span>
                </button>

                <button x-show="canCancel"
                        @click="cancel()"
                        class="btn btn--secondary">
                    Cancel
                </button>

                <button x-show="state.total_phases > 0"
                        @click="openPlan()"
                        class="btn btn--secondary">
                    View Plan
                </button>

                <button @click="openOutput()" class="btn btn--secondary">
                    Open Output
                </button>

                <button x-show="canReset"
                        @click="resetProject()"
                        class="btn btn--secondary btn--danger">
                    Start Over
                </button>
            </div>
        </section>

        <!-- Configuration card -->
        <section class="card" x-show="showConfig">
            <header class="card__header card__header--collapsible" @click="configExpanded = !configExpanded">
                <h2>Configure Project</h2>
                <svg class="chevron" :class="{ 'chevron--down': configExpanded }" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
            </header>

            <div x-show="configExpanded">
                <form @submit.prevent="saveConfig()">
                    <div class="form-group">
                        <label for="project-name">Project Name</label>
                        <input type="text"
                               id="project-name"
                               x-model="config.projectName"
                               placeholder="My Project"
                               required>
                    </div>

                    <div class="form-group">
                        <label for="project-description">What do you want to build?</label>
                        <textarea id="project-description"
                                  x-model="config.projectDescription"
                                  rows="4"
                                  placeholder="Describe your project in detail..."
                                  required></textarea>
                        <small>Be specific about features and requirements</small>
                    </div>

                    <div class="form-group">
                        <label for="default-model">Default Model</label>
                        <select id="default-model" x-model="config.defaultModel">
                            <option value="haiku">Haiku (Fastest)</option>
                            <option value="sonnet">Sonnet (Balanced)</option>
                            <option value="opus">Opus (Most Capable)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox"
                                   x-model="config.allowPlanningQuestions">
                            <span>Allow Claude to ask clarifying questions when generating the plan</span>
                        </label>
                        <small>When enabled, Claude can ask questions before finalizing the plan to better understand your requirements</small>
                    </div>

                    <div class="actions">
                        <button type="submit" class="btn btn--primary" :disabled="loading">
                            <span x-show="loading" class="spinner"></span>
                            Save Configuration
                        </button>
                    </div>
                </form>
            </div>
        </section>

        <!-- Reference Files card -->
        <section class="card" x-show="showConfig">
            <header class="card__header">
                <h2>Reference Files</h2>
            </header>

            <p class="card__subtitle">
                Reference files include documentation, data, or any other files and information you want Claude to use as a reference while executing your project.
            </p>

            <!-- Drop zone -->
            <div class="dropzone"
                 :class="{ 'dropzone--active': isDragging, 'dropzone--has-files': referenceFiles.length > 0 }"
                 @drop="handleFileDrop($event)"
                 @dragover="handleDragOver($event)"
                 @dragleave="handleDragLeave($event)"
                 @click="$refs.fileInput.click()">
                <input type="file"
                       x-ref="fileInput"
                       @change="handleFileInput($event)"
                       multiple
                       style="display: none;">
                <div x-show="referenceFiles.length === 0 && !isDragging">
                    <p>Drag files here or click to browse</p>
                    <small>Drop any files Claude should reference</small>
                </div>
                <div x-show="isDragging">
                    <p>Drop files here...</p>
                </div>
            </div>

            <!-- File list -->
            <div x-show="referenceFiles.length > 0" class="file-list">
                <div class="file-list__header">
                    <span x-text="referenceFiles.length + ' file(s) in reference folder'"></span>
                </div>
                <ul>
                    <template x-for="file in referenceFiles" :key="file.name">
                        <li x-text="file.name"></li>
                    </template>
                </ul>
            </div>

            <!-- No reference files checkbox -->
            <div class="form-group checkbox-group">
                <label>
                    <input type="checkbox" x-model="noReferenceFiles">
                    <span>I don't have any reference files for this project</span>
                </label>
            </div>

            <!-- Actions -->
            <div class="actions">
                <button type="button" @click="openReferences()" class="btn btn--secondary">
                    Open Folder
                </button>
                <button type="button"
                        @click="archiveReferenceFiles()"
                        class="btn btn--secondary"
                        :disabled="referenceFiles.length === 0 || loading">
                    Archive Files
                </button>
                <button type="button"
                        @click="loadReferenceFiles()"
                        class="btn btn--secondary btn--small">
                    Refresh
                </button>
            </div>
        </section>

        <!-- Questions card -->
        <section class="card card--questions" x-show="state.state === 'questions'">
            <header class="card__header">
                <h2>Claude Has Questions</h2>
            </header>

            <p class="card__subtitle">Please answer to continue, or skip to let Claude decide.</p>

            <template x-for="question in questions" :key="question.number">
                <div class="question">
                    <div class="question__topic" x-text="'Question ' + question.number + ': ' + question.topic"></div>
                    <div class="question__text" x-text="question.question"></div>
                    <textarea class="question__input"
                              x-model="question.answer"
                              placeholder="Your answer..."></textarea>
                </div>
            </template>

            <div class="actions">
                <button @click="submitAnswers()" class="btn btn--primary" :disabled="loading">
                    <span x-show="loading" class="spinner"></span>
                    Submit Answers
                </button>
                <button @click="skipQuestions()" class="btn btn--secondary" :disabled="loading">
                    Skip - Let Claude Decide
                </button>
            </div>
        </section>

        <!-- Planning Questions card -->
        <section class="card card--questions" x-show="showPlanQuestions">
            <header class="card__header">
                <h2>Claude Has Questions About Your Project</h2>
            </header>

            <p class="card__subtitle">
                Claude has written some clarifying questions to better understand your project requirements.
                You can answer them to refine the plan, or skip to let Claude proceed with their best judgment.
            </p>

            <div class="activity-box">
                <p x-text="state.activity"></p>
            </div>

            <div class="actions">
                <button @click="openQuestionsFile()" class="btn btn--primary">
                    Open Questions File
                </button>
                <button @click="continueAfterQuestions(false)" class="btn btn--primary" :disabled="loading">
                    <span x-show="loading" class="spinner"></span>
                    Continue (I've Answered)
                </button>
                <button @click="continueAfterQuestions(true)" class="btn btn--secondary" :disabled="loading">
                    Skip Questions
                </button>
            </div>
        </section>

        <!-- System status card -->
        <section class="card">
            <header class="card__header">
                <h2>System Status</h2>
            </header>

            <div class="info-grid">
                <div class="info-row">
                    <span class="info-label">Claude Installed</span>
                    <span x-text="system.installed ? 'Yes' : 'No'"></span>
                </div>
                <div class="info-row">
                    <span class="info-label">Logged In</span>
                    <span x-text="system.email || 'Not logged in'"></span>
                </div>
                <div class="info-row">
                    <span class="info-label">Version</span>
                    <span x-text="system.version || '-'"></span>
                </div>
                <div class="info-row">
                    <span class="info-label">Process</span>
                    <span x-text="state.process_id ? 'Running (PID ' + state.process_id + ')' : 'Idle'"></span>
                </div>
                <div class="info-row">
                    <span class="info-label">Connection</span>
                    <span :class="connected ? '' : 'status-dot--error'" x-text="connected ? 'Connected' : 'Disconnected'"></span>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer>
            Simple Claude Conductor v2.0 |
            <a href="#" @click.prevent="refresh()">Refresh</a> |
            <a href="#" @click.prevent="openArchive()">Archives</a>
        </footer>
    </div>

    <!-- Application scripts -->
    <script src="/static/js/api.js"></script>
    <script src="/static/js/app.js"></script>
</body>
</html>
